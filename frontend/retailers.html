<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Retailers</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
<h2 class="mb-3">Retailers</h2>
<ul id="retailerList" class="list-group mb-3"></ul>
<form id="retForm" class="row g-2">
    <div class="col-auto"><input class="form-control" id="retUser" placeholder="Username" required></div>
    <div class="col-auto"><input class="form-control" id="retPass" type="password" placeholder="Password" required></div>
    <div class="col-auto"><button class="btn btn-secondary" type="submit">Add Retailer</button></div>
</form>
<script src="/static/api.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
async function load(){
    const resp = await apiFetch('/auth/retailers?admin_token=adminsecret');
    if(!resp.ok) return;
    const data = await resp.json();
    const list = document.getElementById('retailerList');
    list.innerHTML = '';
    data.forEach(r=>{
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.innerHTML = `<span>${r.username}</span><button class="btn btn-sm btn-danger" data-user="${r.username}">Delete</button>`;
        li.querySelector('button').onclick = async () => {
            await apiFetch('/auth/retailers/'+r.username+'?admin_token=adminsecret', {method:'DELETE'});
            load();
        };
        list.appendChild(li);
    });
}

document.getElementById('retForm').addEventListener('submit', async e=>{
    e.preventDefault();
    const u=document.getElementById('retUser').value;
    const p=document.getElementById('retPass').value;
    const body={username:u,password:p,role:'retailer',admin_token:'adminsecret'};
    const resp=await apiFetch('/auth/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
    if(resp.ok){
        e.target.reset();
        load();
    }else{
        alert('Error');
    }
});

load();
</script>
</body>
</html>
